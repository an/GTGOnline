{% extends 'content.html' %}

{% block task_row %}
	<div data-bind="foreach: tasks_list" id="task_rows_container" class="min-width900">
	<div class="task-row min-width900" id="task_row" style="display: block;" data-bind="style: { marginLeft: (40*indent) + 'px', borderLeft: indent > 0 ? '1px solid #dedede' : '0px'}, css: { taskDone: status == 1, taskDismissed: status == 2 }">
		<div class="div-inline pull-left min-width25" style="margin-left: 5px">
			<input type="checkbox" class="checkbox" data-bind="attr: { 'value': id }, checked: $root.modify_selected">
		</div>
		
		<div class="div-inline pull-left min-width30" style="margin-right: 2px; border-right: 1px solid #dedede; min-width: 30px;">
			<a data-toggle="collapse" data-target="#collapse11" href="#" style="text-decoration:none; color:#4d4d4d; font-size: 20px;" id="subtask_count" data-bind="visible: subtasks.length > 0">
                <span data-bind="text: subtasks.length > 0 ? '+' + subtasks.length : ''"></span>
				<!--<span data-bind="text: $index()"></span>-->
            </a>
			<span data-bind="visible: subtasks.length == 0, text: '&nbsp;'"></span>
		</div>
		
		<div class="dropdown div-inline pull-left min-width250" style="width: 26%;">
			<a class="dropdown-toggle" data-toggle="dropdown" href="#" style="text-decoration:none; color:#4d4d4d; font-size: 15px;" id="name_link">
				<!--<strong>Summer's here: Lets clean the house!</strong>-->
				<strong id="name" data-bind="text: name"></strong>
			</a>
			<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
				<li><a href="#" data-bind="click: $root.add_subtask.bind($data, id)"><i class="icon-plus"></i>&nbsp;Add subtask</a></li>
				<li data-bind="visible: status != 0"><a href="#" data-bind="click: $root.change_status.bind($data, id, 0, $index())"><i class="icon-play"></i>&nbsp;Active</a></li>
				<li data-bind="visible: status != 1"><a href="#" data-bind="click: $root.change_status.bind($data, id, 1, $index())"><i class="icon-ok"></i>&nbsp;Done</a></li>
				<li data-bind="visible: status != 2"><a href="#" data-bind="click: $root.change_status.bind($data, id, 2, $index())"><i class="icon-minus-sign"></i>&nbsp;Dismissed</a></li>
				<li><a href="#" data-bind="click: $root.delete_task.bind($data, id, $index())"><i class="icon-trash"></i>&nbsp;Delete</a></li>
			</ul>
		</div>
		
		<div style="width: 15%;" class="div-inline min-width200 task-tags" id="tags" data-bind="foreach: tags">
			<a href="#" style="text-decoration:none">
                <span class="label" data-bind="text: name, style: { backgroundColor: color }"></span>
            </a>
		</div>
		
		<div class="div-inline task-description max-width350" style="width: 32%;">
			<a href="#" style="text-decoration:none">
                <span class="muted" id="description" data-bind="text: description"></span>
			</a>
		</div>
		
		<div style="width: 10%" class="div-inline min-width130 pull-right">
			<a href="#" style="text-decoration:none; color:#4D4D4D;">
				<!--<strong style="font-size: 30px;">13.09.12</strong>-->
				<strong style="font-size: 30px;" id="due_date" data-bind="text: due_date"></strong>
			</a>
		</div>
		
		<div style="width: 10%" class="div-inline min-width80 pull-right">
			<a href="#" style="text-decoration:none; color:#4d4d4d;">
				<!--<strong>06.09.12</strong>-->
				<strong id="start_date" data-bind="text: due_date"></strong>
			</a>
		</div>
	</div>
	
	<!-- ko template: { name: 'task_rows_container', foreach: subtasks } -->
	<!-- /ko -->
	</div>
{% endblock task_row %}

{% block external_js %}
{{ block.super }}

<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/data/tasks.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/data/knockout-mapping-plugin.js"></script>
<script type="text/javascript">
	$(window).load(function(){
        //show_tasks(task_tree);
    });
	
	$("#subtask_count2").click(function() { 
		$("#task_row4").fadeToggle();
		return false;
	});
	
	$("#subtask_count").click(function() {
		/*$.getJSON("/tasks/json_dumps/", function(result){
			var items = [];
			$.each(result, function(key, val) {
				items.push('<li id="' + key + '">' + val + '</li>');
			});
			
			$('<ul/>', {
				'class': 'my-new-list',
				html: items.join('')
			}).appendTo('#main_div');
		});*/
	});
	
	$(document).ready(function(){
		//var obj = get_tasks_ajax();
		//get_tags_by_user();
		//alert(obj);
		//ko.applyBindings(task_array());
	});
</script>

{% endblock external_js %}
